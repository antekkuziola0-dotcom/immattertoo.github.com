<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImMatterToo - Pilot 2026</title>
    <style>
        :root { --primary: #007bff; --bg: #0d0d0d; --danger: #dc3545; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; text-align: center; }
        .tabs { display: flex; background: #1a1a1a; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        .tab { flex: 1; padding: 20px; cursor: pointer; color: #888; font-weight: bold; }
        .tab.active { color: white; border-bottom: 4px solid var(--primary); background: #222; }
        .content { display: none; padding: 30px; animation: fadeIn 0.3s; }
        .content.active { display: block; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; max-width: 400px; margin: auto; }
        .btn { background: #333; color: white; border: 1px solid #444; padding: 20px; border-radius: 12px; font-size: 16px; cursor: pointer; }
        .btn:active { background: var(--primary); transform: scale(0.95); }
        .btn-danger { background: #4b0000; color: #ff9999; border-color: #800000; }
        #compass-icon { font-size: 80px; margin: 20px 0; transition: 0.2s; }
        .north-active { color: #00ff00; text-shadow: 0 0 20px #00ff00; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="tabs">
        <div id="t-android" class="tab active" onclick="showTab('android')">KOMPAS</div>
        <div id="t-pilot" class="tab" onclick="showTab('pilot')">PILOT</div>
        <div id="t-windows" class="tab" onclick="showTab('windows')">INFO</div>
    </div>

    <!-- ZAK≈ÅADKA KOMPAS -->
    <div id="android" class="content active">
        <h1>Parowanie Magnetyczne</h1>
        <div id="compass-icon">üß≠</div>
        <div id="degrees" style="font-size: 24px;">0¬∞</div>
        <p>Skieruj telefon na P√≥≈Çnoc, by wys≈Çaƒá sygna≈Ç testowy.</p>
        <button class="btn" style="background:#28a745;" onclick="initSensors()">AKTYWUJ CZUJNIKI</button>
    </div>

    <!-- ZAK≈ÅADKA PILOT -->
    <div id="pilot" class="content">
        <h1>Centrum Sterowania</h1>
        <div class="grid">
            <button class="btn" style="grid-column: span 2;" onclick="sendCmd('SPACE')">‚èØ PAUZA / PLAY</button>
            <button class="btn" onclick="sendCmd('VOL_UP')">üîä G≈ÅO≈öNIEJ</button>
            <button class="btn" onclick="sendCmd('VOL_DOWN')">üîâ CISZEJ</button>
            <button class="btn" onclick="sendCmd('LOCK')">üîí BLOKADA</button>
            <button class="btn" onclick="sendCmd('RESTART')">üîÑ RESTART</button>
            <button class="btn btn-danger" style="grid-column: span 2;" onclick="confirmShutdown()">üõë WY≈ÅƒÑCZ SYSTEMY (2x)</button>
        </div>
    </div>

    <!-- ZAK≈ÅADKA WINDOWS -->
    <div id="windows" class="content">
        <h2>Instrukcja dla 8 laptop√≥w</h2>
        <p>1. Skopiuj <code>injector.exe</code> na pendrive.</p>
        <p>2. Uruchom go na ka≈ºdym laptopie.</p>
        <p>3. Program doda siƒô do autostartu i bƒôdzie dzia≈Ça≈Ç w tle.</p>
    </div>

    <script>
        const BUCKET = "BZVwGAUSEU4XGp4G8az3rC";
        const API_URL = `kvdb.io{BUCKET}/status`;

        function showTab(id) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('t-' + id).classList.add('active');
        }

        async function sendCmd(msg) {
            try {
                await fetch(API_URL, { method: 'POST', body: msg });
                console.log("Wys≈Çano:", msg);
                if (navigator.vibrate) navigator.vibrate(50);
            } catch (e) { console.error("B≈ÇƒÖd sieci"); }
        }

        let sClicks = 0;
        function confirmShutdown() {
            sClicks++;
            if (sClicks === 1) {
                event.target.innerText = "NA PEWNO?";
                setTimeout(() => { sClicks = 0; event.target.innerText = "üõë WY≈ÅƒÑCZ SYSTEMY (2x)"; }, 3000);
            } else {
                sendCmd('SHUTDOWN');
                sClicks = 0;
            }
        }

        function initSensors() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(resp => {
                    if (resp === 'granted') window.addEventListener('deviceorientationabsolute', handleCompass);
                });
            } else {
                window.addEventListener('deviceorientationabsolute', handleCompass);
            }
        }

        function handleCompass(event) {
            let alpha = event.alpha;
            if (alpha === null) return;
            document.getElementById('degrees').innerText = Math.round(alpha) + "¬∞";
            if (alpha < 15 || alpha > 345) {
                document.getElementById('compass-icon').classList.add('north-active');
                // Opcjonalnie: sendCmd('SPACE');
            } else {
                document.getElementById('compass-icon').classList.remove('north-active');
            }
        }
    </script>
</body>
</html>
