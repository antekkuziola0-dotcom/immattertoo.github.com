<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImMatterToo QR Protocol 2026</title>
    <!-- LOKALNE BIBLIOTEKI Z TWOJEGO REPOZYTORIUM -->
    <script src="html5-qrcode.min(1).js"></script>
    <script src="qrcode.min.js"></script>
    <style>
        :root { --primary: #007bff; --bg: #0d0d0d; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; text-align: center; }
        
        /* Menu Zak≈Çadek */
        .tabs { display: flex; background: #1a1a1a; border-bottom: 1px solid #333; position: sticky; top: 0; z-index: 100; }
        .tab { flex: 1; padding: 15px; cursor: pointer; color: #888; font-weight: bold; transition: 0.3s; }
        .tab.active { color: white; border-bottom: 4px solid var(--primary); background: #222; }
        
        /* Zawarto≈õƒá Zak≈Çadek */
        .content { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .content.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Style QR */
        #reader { width: 100%; max-width: 400px; margin: auto; background: white; border-radius: 10px; overflow: hidden; }
        #qrcode { background: white; padding: 20px; display: inline-block; border-radius: 10px; margin-top: 20px; }

        /* Styl Pilota */
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-width: 400px; margin: auto; }
        .btn { background: #333; color: white; border: 1px solid #444; padding: 20px; border-radius: 10px; cursor: pointer; transition: 0.2s; }
        .btn:active { background: var(--primary); transform: scale(0.95); }
        .btn-danger { background: #4b0000; color: #ff9999; border-color: #800000; }
    </style>
</head>
<body>

    <div class="tabs">
        <div id="t-scan" class="tab active" onclick="showTab('scan')">SKANUJ (TELEFON)</div>
        <div id="t-host" class="tab" onclick="showTab('host')">HOST (LAPTOP)</div>
        <div id="t-pilot" class="tab" onclick="showTab('pilot')">PILOT</div>
    </div>

    <!-- SKANER (DLA TELEFONU) -->
    <div id="scan" class="content active">
        <h1>Skanuj Laptop</h1>
        <div id="reader"></div>
        <p id="scan-status">Wyceluj aparat w kod QR na laptopie</p>
    </div>

    <!-- HOST (DLA LAPTOPA) -->
    <div id="host" class="content">
        <h1>Tw√≥j Kod QR</h1>
        <p>Zeskanuj to telefonem Moto E13</p>
        <div id="qrcode"></div>
        <p>ID: <span id="my-id">...</span></p>
    </div>

    <!-- PILOT (PO PO≈ÅƒÑCZENIU) -->
    <div id="pilot" class="content">
        <h1>Sterowanie</h1>
        <div class="grid">
            <button class="btn" style="grid-column: span 2;" onclick="send('SPACE')">‚èØ PLAY/PAUSE</button>
            <button class="btn" onclick="send('VOL_UP')">üîä VOL +</button>
            <button class="btn" onclick="send('VOL_DOWN')">üîâ VOL -</button>
            <button class="btn" onclick="send('LOCK')">üîí BLOKADA</button>
            <button class="btn" onclick="send('RESTART')">üîÑ RESTART</button>
            <button class="btn btn-danger" style="grid-column: span 2;" onclick="send('SHUTDOWN')">üõë WY≈ÅƒÑCZ (SHUTDOWN)</button>
        </div>
    </div>

    <script>
        // Czekaj na za≈Çadowanie ca≈Çego HTML i bibliotek, zanim uruchomisz skrypt
        document.addEventListener('DOMContentLoaded', (event) => {
            let currentBucket = "BZVwGAUSEU4XGp4G8az3rC"; // Tw√≥j klucz KVdb.io
            let qrCodeGenerated = false;
            let html5QrCode = new Html5Qrcode("reader"); // Globalna instancja

            function showTab(id) {
                document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.getElementById(id).classList.add('active');
                document.getElementById('t-' + id).classList.add('active');
                
                if (id === 'host' && !qrCodeGenerated) {
                    generateQRCode();
                    qrCodeGenerated = true;
                    html5QrCode.stop().catch(e => {});
                } else if (id === 'scan') {
                    startScanner();
                } else {
                    html5QrCode.stop().catch(e => {}); 
                }
            }

            // --- GENEROWANIE QR NA LAPTOPIE ---
            function generateQRCode() {
                const qrElement = document.getElementById("qrcode");
                if (qrElement) {
                    new QRCode(qrElement, {
                        text: currentBucket,
                        width: 200,
                        height: 200
                    });
                    document.getElementById('my-id').innerText = currentBucket;
                }
            }

            // --- SKANOWANIE NA TELEFONIE (Moto E13) ---
            function startScanner() {
                html5QrCode.start(
                    { facingMode: "environment" }, 
                    { fps: 10, qrbox: 250 },
                    (decodedText) => {
                        html5QrCode.stop();
                        alert("Sparowano z laptopem! ID: " + decodedText);
                        currentBucket = decodedText; 
                        showTab('pilot');
                    }
                );
            }

            // --- WYSY≈ÅANIE KOMEND (PILOT) ---
            async function send(msg) {
                const url = `kvdb.io{currentBucket}/status`;
                try {
                    await fetch(url, { method: 'POST', body: msg });
                    if (navigator.vibrate) navigator.vibrate(50);
                } catch (e) { console.error("B≈ÇƒÖd wysy≈Çania komendy:", e); }
            }

            // Domy≈õlnie poka≈º zak≈Çadkƒô skanowania przy ≈Çadowaniu strony
            showTab('scan');
        });
    </script>
</body>
</html>

